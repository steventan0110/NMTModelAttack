#!/bin/bash

source /home/steven/Documents/GITHUB/NMTModelAttack/ma/bin/activate
ROOT=/home/steven/Documents/GITHUB/NMTModelAttack


for percent in 10 15 20 25 30
do
  OUT=$ROOT/output/adv/adv-mrt-c15-p$percent-unused.out
  DATA=$ROOT/dataset/noise-data
  fairseq-generate \
  /home/steven/Documents/GITHUB/NMTModelAttack/data-bin/20k \
  --task translation \
  --gen-subset test \
  --path /home/steven/Documents/GITHUB/NMTModelAttack/checkpoints/zh-en-noshare/checkpoint_best.pt \
  --batch-size 64 \
  --adv-gen \
  --adv-model-path /home/steven/Documents/GITHUB/NMTModelAttack/checkpoints/dual-mrt/zh-en/checkpoint15.pt \
  --adv-percent $percent \
  --lenpen 1.0 \
  --remove-bpe sentencepiece \
  --sacrebleu \
  --src-file $DATA/replace-$percent.zh --tgt-file $DATA/replace-$percent.en \
  -s zh \
  -t en \
  --beam 5 > $OUT
done


